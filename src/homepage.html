<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Homepage</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="css/zerogrid.css">
    <link rel="stylesheet" href="css/homepage.css">
    <link rel="stylesheet" href="css/search.css">
    <script src="js/jquery-latest.min.js"></script>
    <script src="js/script.js"></script>
</head>
<body onload="init()">
<div class="wrap-body">
    <!--Header-->
    <header>
        <div class="wrap-header zerogrid">
            <div class="row">
                <div id="cssmenu">
                    <ul>
                        <li class='active'><a href="homepage.html">Home</a></li>
                        <li><a href="img_edit.html">PicEdit</a></li>
                        <li id="login"><a href="login.html">Login</a></li>
                        <li id="register"><a href="register.html">Register</a></li>
                        <li style="cursor: pointer" id="logout" onclick="logout()"><a>Logout</a></li>
                    </ul>
                </div>
                <a class="logo"><img src="img/homepage/logo.png"/></a>
                <div class="wrap clearfix">
                    <div class="header">
                        <input class="intCity" type="text" placeholder="Search a tag" value="">
                        <input class="seachBtn" type="button" value="Seach">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!--Container-->
    <section id="container">
        <div class="zerogrid">
            <div class="wrap-container clearfix">
                <div id="main-content">
                    <div class="row wrap-content">
                        <!--Start Box-->
                        <div class="header">
                            <h1>Save Your Lovely Moments</h1>
                            <span>
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                <br/>
                                Iste ratione molestias magni.
                            </span>
                        </div>
                        <div class="row" id="container_row"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script src="js/JquerySession.js"></script>
<script type="text/javascript">
    function init() {
        // testAuth
        $.ajax({
            url: "http://127.0.0.1:3000/testAuth",
            type: "get",
            xhrFields: {
                withCredentials: true
            },
            success: function (res) {
                if (res.auth) {
                    $("#login").css("display", "none");
                    $("#register").css("display", "none");
                    $("#logout").css("display", "inline")
                }
                else {
                    $("#logout").css("display", "none");
                    $("#login").css("display", "inline");
                    $("#register").css("display", "inline")
                }
            },
            error: function () {
                $("#logout").css("display", "none");
                $("#login").css("display", "inline");
                $("#register").css("display", "inline")
            }
        });

        // get pics from the server
        $.ajax({
            url: "http://127.0.0.1:3000/picInit",
            type: "get",
            xhrFields: {
                withCredentials: true
            },
            success: function (res) {
                var imgList = res.imgList;

                var index = 0;
                var $wrap_col = $('<div class="wrap-col"></div>');
                var $col_1_3 = $('<div class="col-1-3"></div>');

                for (var i = 0; i < imgList.length; i++) {
                    index++;

                    var $item_container = $('<div class="item-container"></div>');
                    var $a = $('<a href="detail.html" name='+ imgList[i].tags +'></a>');
                    $a.click(function () {
                        toDetailPage(this);
                    });
                    $item_container.append($a);

                    var $item_caption = $('<div class="item-caption"></div>');
                    var $img = $('<img id="a_img" src=' + imgList[i].url + '>');
                    $a.append($item_caption);
                    $a.append($img);

                    var $item_caption_inner = $('<div class="item-caption-inner"></div>');
                    $item_caption.append($item_caption_inner);

                    var $item_caption_inner1 = $('<div class="item-caption-inner1"></div>');
                    $item_caption_inner.append($item_caption_inner1);

                    var $h3 = $('<h3>Lorem ipsum</h3>');
                    var $span = $('<span id="a_span">' + imgList[i].tags + '</span>');
                    $item_caption_inner1.append($h3);
                    $item_caption_inner1.append($span);

                    $wrap_col.append($item_container);

                    if (index % 4 === 0) {
                        $col_1_3.append($wrap_col);
                        $("#container_row").append($col_1_3);
                        $col_1_3 = $('<div class="col-1-3"></div>');
                        $wrap_col = $('<div class="wrap-col"></div>');
                        index = 0;
                    }
                }
            },
            error: function () {
                alert("Internal server error!")
            }
        });
    }

    function toDetailPage(element) {
        $.session.set('detailImgUrl', $(element).children('#a_img')[0].currentSrc);
        $.session.set('detailImgTags', element.name);
    }

    function logout() {
        $.ajax({
            url: "http://127.0.0.1:3000/logout",
            type: "get",
            xhrFields: {
                withCredentials: true
            },
            success: function (res) {
                if (!res.auth) {
                    alert("logout successfully!");
                    window.location.href = "login.html"
                }
                else {
                    alert("logout error!")
                }
            },
            error: function () {
                alert("logout error!")
            }
        });
    }
</script>

</body>
</html>